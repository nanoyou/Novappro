<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.akagawatsurunaki.novappro.mapper.CourseMapper">


    <select id="selectAllCourses"
            resultType="com.github.akagawatsurunaki.novappro.model.database.course.Course">

        SELECT ANY_VALUE(`teacher_id`)                 AS `teacher_id`,
               group_concat(`username` SEPARATOR ', ') AS `teachers`,
               ANY_VALUE(`code`)                       AS `code`,
               ANY_VALUE(`name`)                       AS `name`,
               ANY_VALUE(`credit`)                     AS `credit`,
               ANY_VALUE(`serial_number`)              AS `serial_number`,
               ANY_VALUE(`online_contact_way`)         AS `online_contact_way`,
               ANY_VALUE(`comment`)                    AS `comment`
        FROM (SELECT `teacher_id`, `username`, `course_code`
              FROM `user`
                       INNER JOIN `teaches` ON `user`.`id` = `teaches`.teacher_id) AS teacher_name_table
                 INNER JOIN course ON course.`code` = `course_code`
        GROUP BY `course_code`;

    </select>
    <select id="selectCourseByCode"
            resultType="com.github.akagawatsurunaki.novappro.model.database.course.Course">
        SELECT ANY_VALUE(`teacher_id`)                 AS `teacher_id`,
               group_concat(`username` SEPARATOR ', ') AS `teachers`,
               ANY_VALUE(`code`)                       AS `code`,
               ANY_VALUE(`name`)                       AS `name`,
               ANY_VALUE(`credit`)                     AS `credit`,
               ANY_VALUE(`serial_number`)              AS `serial_number`,
               ANY_VALUE(`online_contact_way`)         AS `online_contact_way`,
               ANY_VALUE(`comment`)                    AS `comment`
        FROM (SELECT *
              FROM (SELECT * FROM course AS c WHERE c.`code` = #{code}) AS tmp
                       INNER JOIN teaches AS tc ON tmp.`code` = tc.course_code) AS course_tmp
                 INNER JOIN `user` AS u ON u.id = course_tmp.`teacher_id`
        GROUP BY `code`;

    </select>
    <select id="selectCourses" resultType="com.github.akagawatsurunaki.novappro.model.database.course.Course">
        SELECT ANY_VALUE(`teacher_id`) AS `teacher_id`,
        group_concat(`username` SEPARATOR ', ') AS `teachers`,
        ANY_VALUE(`code`) AS `code`,
        ANY_VALUE(`name`) AS `name`,
        ANY_VALUE(`credit`) AS `credit`,
        ANY_VALUE(`serial_number`) AS `serial_number`,
        ANY_VALUE(`online_contact_way`) AS `online_contact_way`,
        ANY_VALUE(`comment`) AS `comment`
        FROM (SELECT *
        FROM (SELECT * FROM course AS c WHERE c.`code` IN
        <foreach item="code" index="index" collection="list" open="(" separator="," close=")">
            #{code}
        </foreach>
        ) AS tmp
        INNER JOIN teaches AS tc ON tmp.`code` = tc.course_code) AS course_tmp
        INNER JOIN `user` AS u ON u.id = course_tmp.`teacher_id`
        GROUP BY `code`;
    </select>
</mapper>